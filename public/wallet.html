<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>My Wallet â€” All City Pages</title>
<style>
  :root { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
  body{ margin:0; background:#0b1220; color:#e5e7eb; }
  header { padding:14px 18px; background:#020617; position:sticky; top:0; }
  .wrap { max-width:900px; margin:0 auto; padding:18px; }
  .card{ background:#111827; border:1px solid #1f2937; border-radius:16px; padding:14px; margin:8px 0; display:flex; gap:12px; align-items:center; }
  img { width:96px; height:64px; object-fit:cover; border-radius:8px; }
  .btn{ background:#2563eb; color:#fff; border:0; padding:10px 12px; border-radius:10px; cursor:pointer; }
  .btn.secondary{ background:#f97316; }
</style>
</head>
<body>
<header><a href="/offers.html" style="color:#93c5fd;text-decoration:none">&larr; Offers</a></header>
<div class="wrap">
  <h1>My Wallet</h1>
  <div id="list"></div>
</div>
<script>
  async function loadOffers(){
    const res = await fetch('/api/offers'); const j = await res.json();
    return j.offers || [];
  }
  function render(list, catalog){
    const root = document.getElementById('list');
    if (!list.length) { root.innerHTML = '<p>No saved offers yet.</p>'; return; }
    root.innerHTML = list.map(id => {
      const o = catalog.find(x=>x.id===id) || { title:id, restaurant:'', hero_image:'' };
      return `
        <div class="card">
          ${o.hero_image ? `<img src="${o.hero_image}">` : `<div style="width:96px;height:64px;background:#0f172a;border-radius:8px"></div>`}
          <div style="flex:1">
            <div style="font-weight:700">${o.title}</div>
            <div style="color:#94a3b8;font-size:13px">${o.restaurant||''}</div>
          </div>
          <a class="btn secondary" href="/coupon?offer=${encodeURIComponent(o.id)}">Redeem</a>
          <button class="btn" onclick="removeOffer('${o.id}')">Remove</button>
        </div>`;
    }).join('');
  }
  function removeOffer(id){
    const key='wallet_offers';
    const cur = JSON.parse(localStorage.getItem(key)||'[]').filter(x=>x!==id);
    localStorage.setItem(key, JSON.stringify(cur));
    init();
  }
  async function init(){
    const key='wallet_offers';
    const saved = JSON.parse(localStorage.getItem(key)||'[]');
    const catalog = await loadOffers();
    render(saved, catalog);
  }
  init();
</script>
</body>
</html>
