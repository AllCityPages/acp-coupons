<!doctype html>
<html>
<head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Merchant Dashboard</title>
<style>
body{font-family:system-ui,Arial;background:#fff;color:#111;margin:0}
header{padding:16px;border-bottom:1px solid #eee;display:flex;gap:12px;align-items:center}
header img{height:32px}
.kpis{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;padding:16px}
.card{border:1px solid #eee;border-radius:12px;padding:14px;box-shadow:0 1px 4px rgba(0,0,0,.05)}
.big{font-size:28px;font-weight:700}
canvas{width:100%;height:300px}
footer{text-align:center;padding:16px;color:#444;border-top:1px solid #eee}
</style>
</head>
<body>
<header>
  <img src="/static/logo-acp.png"/><div><strong>Merchant Dashboard</strong><br/>
  <small>All City Pages â€” Real Usage, Real ROI</small></div>
</header>

<div class="kpis">
  <div class="card"><div>Scans</div><div class="big" id="scans">0</div></div>
  <div class="card"><div>Wallet Adds</div><div class="big" id="wallet">0</div></div>
  <div class="card"><div>Redemptions</div><div class="big" id="redeem">0</div></div>
  <div class="card"><div>Revenue (est.)</div><div class="big" id="revenue">$0</div></div>
</div>

<div class="card" style="margin:16px">
  <div style="padding-bottom:8px"><strong>Last 30 Days: Redemptions</strong></div>
  <canvas id="chart" width="900" height="300"></canvas>
</div>

<footer>AllCityPages.com | info@AllCityPages.com</footer>

<script>
const fmtUSD = n => '$' + (Math.round(n*100)/100).toLocaleString();

async function load() {
  const res = await fetch('/api/dashboard/summary');
  const data = await res.json();
  document.getElementById('scans').textContent = data.scans;
  document.getElementById('wallet').textContent = data.wallet_adds;
  document.getElementById('redeem').textContent = data.redemptions;
  document.getElementById('revenue').textContent = fmtUSD(data.estimated_revenue);

  const ctx = document.getElementById('chart').getContext('2d');
  const W = ctx.canvas.width, H = ctx.canvas.height;
  ctx.clearRect(0,0,W,H);
  const vals = data.daily.map(d=>d.redemptions);
  const max = Math.max(1, ...vals);
  const step = (W-40)/Math.max(1, vals.length-1);
  ctx.beginPath();
  data.daily.forEach((d,i)=>{
    const x = 20 + i*step;
    const y = 280 - (d.redemptions/max)*240;
    if (i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
  });
  ctx.stroke();
}
load();
</script>
</body></html>
